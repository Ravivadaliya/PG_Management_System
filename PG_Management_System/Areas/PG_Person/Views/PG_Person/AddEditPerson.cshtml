@{
    Layout = "~/Views/Shared/Admin/AdminLayout.cshtml";
}
    @model PG_Management_System.Areas.PG_Person.Models.Person;
<div class="container">
    <div class="page-inner">
        <div class="page-header">
            <h3 class="fw-bold mb-3">Add Person</h3>
            <ul class="breadcrumbs mb-3">
                <li class="nav-home">
                    <a href="#">
                        <i class="icon-home"></i>
                    </a>
                </li>
                <li class="separator">
                    <i class="icon-arrow-right"></i>
                </li>
                <li class="nav-item">
                    <a href="#">Person</a>
                </li>
                <li class="separator">
                    <i class="icon-arrow-right"></i>
                </li>
                <li class="nav-item">
                    <a href="#">Add Person</a>
                </li>
            </ul>
        </div>
        <div class="row">
            <div class="col-md-12">
                <form asp-area="PG_Person" asp-controller="PG_Person" asp-action="SavePerson" enctype="multipart/form-data" method="post">
                    @Html.HiddenFor(x => x.Id)
                    @Html.HiddenFor(x => x.Owner_ID)
                    @Html.HiddenFor(x => x.Person_Image)
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Fill Person Details</div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 col-lg-12">
                                    <div class="form-group form-inline">
                                        <label for="inlineinput"
                                               class="col-md-3 col-form-label">Enter Name*</label>
                                        <div class="col-md-9 p-0">
                                            <input type="text"
                                                   asp-for="Person_Name"
                                                   class="form-control input-full"
                                                   id="inlineinput"
                                                   placeholder="xyz" />
                                            <span asp-validation-for="Person_Name" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="form-group form-inline">
                                        <label for="inlineinput"
                                               class="col-md-3 col-form-label">Enter Surname*</label>
                                        <div class="col-md-9 p-0">
                                            <input type="text"
                                                   asp-for="Person_Surname"
                                                   class="form-control input-full"
                                                   id="inlineinput"
                                                   placeholder="abc" />
                                            <span asp-validation-for="Person_Surname" class="text-danger"></span>
                                        </div>
                                    </div>

                                    <div class="form-group form-inline">
                                        <label for="inlineinput"
                                               class="col-md-3 col-form-label">Enter Mobile Number*</label>
                                        <div class="col-md-9 p-0">
                                            <input type="text"
                                                   asp-for="Person_Mobile_Number"
                                                   class="form-control input-full"
                                                   id="inlineinput"
                                                   placeholder="Enter Mobile Number" />
                                            <span asp-validation-for="Person_Mobile_Number" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="form-group form-inline">
                                        <label for="inlineinput"
                                               class="col-md-3 col-form-label">Enter Parent Mobile Number*</label>
                                        <div class="col-md-9 p-0">
                                            <input type="text"
                                                   asp-for="Person_Parent_Mobile_Number"
                                                   class="form-control input-full"
                                                   id="inlineinput"
                                                   placeholder="Enter Mobile Number" />
                                            <span asp-validation-for="Person_Parent_Mobile_Number" class="text-danger"></span>
                                        </div>
                                    </div>


                                    <div class="form-group form-inline">
                                        <label for="inlineinput"
                                               class="col-md-3 col-form-label">Enter EmailId*</label>
                                        <div class="col-md-9 p-0">
                                            <input type="email"
                                                   asp-for="Person_Email_ID"
                                                   class="form-control input-full"
                                                   id="inlineinput"
                                                   placeholder="Your Email" />
                                            <span asp-validation-for="Person_Email_ID" class="text-danger"></span>
                                        </div>
                                    </div>

                                    <div class="form-group form-inline">
                                        <label for="inlineinput"
                                               class="col-md-3 col-form-label">Enter City*</label>
                                        <div class="col-md-9 p-0">
                                            <input type="text"
                                                   asp-for="Person_City"
                                                   class="form-control input-full"
                                                   id="inlineinput"
                                                   placeholder="" />
                                            <span asp-validation-for="Person_City" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="form-group form-inline">
                                        <label for="inlineinput"
                                               class="col-md-3 col-form-label">Enter WorkPlace*</label>
                                        <div class="col-md-9 p-0">
                                            <input type="text"
                                                   asp-for="Person_WorkPlace"
                                                   class="form-control input-full"
                                                   id="inlineinput"
                                                   placeholder="" />
                                            <span asp-validation-for="Person_WorkPlace" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="form-group form-inline">
                                        <label for="inlineinput"
                                               class="col-md-3 col-form-label">Enter WorkPlace Contact number*</label>
                                        <div class="col-md-9 p-0">
                                            <input type="text"
                                                   asp-for="Person_WorkPlace_MobileNumber"
                                                   class="form-control input-full"
                                                   id="inlineinput"
                                                   placeholder="" />
                                            <span asp-validation-for="Person_WorkPlace_MobileNumber" class="text-danger"></span>
                                        </div>
                                    </div>

                                    <div class="form-group form-inline">
                                        <label for="inlineinput"
                                               class="col-md-3 col-form-label">Select Gender*</label>
                                        <div class="col-md-9 p-0">
                                            <select class="form-control input-full" data-control="select2" data-placeholder="Select PG" data-allow-clear="true" asp-for="Person_Gender">
                                                <option value="">Select Gender*</option>
                                                <option value="Male">Male</option>
                                                <option value="Female">Female</option>
                                            </select>
                                            <span asp-validation-for="Person_Gender" class="text-danger"></span>
                                        </div>
                                    </div>

                                    <div class="form-group form-inline">
                                        <label for="inlineinput"
                                               class="col-md-3 col-form-label">Enter Profession*</label>
                                        <div class="col-md-9 p-0">
                                            <input type="text"
                                                   asp-for="Person_Profession"
                                                   class="form-control input-full"
                                                   id="inlineinput"
                                                   placeholder="" />
                                            <span asp-validation-for="Person_Profession" class="text-danger"></span>
                                        </div>
                                    </div>

                                    <div class="form-group form-inline">
                                        <label for="inlineinput"
                                               class="col-md-3 col-form-label">Enter Address*</label>
                                        <div class="col-md-9 p-0">
                                            <input type="text"
                                                   asp-for="Person_Address"
                                                   class="form-control input-full"
                                                   id="inlineinput"
                                                   placeholder="" />
                                            <span asp-validation-for="Person_Address" class="text-danger"></span>
                                        </div>
                                    </div>

                                    <div class="form-group form-inline">
                                        <label for="inlineinput"
                                               class="col-md-3 col-form-label">Enter Person JoningDate*</label>
                                        <div class="col-md-9 p-0">
                                            <input type="date"
                                                   asp-for="Person_JoningDate"
                                                   class="form-control input-full"
                                                   id="inlineinput"
                                                   placeholder="" />
                                            <span asp-validation-for="Person_JoningDate" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="exampleFormControlFile1">Upload Your Photo</label>
                                        <input type="file"
                                               asp-for="File"
                                               class="form-control-file"
                                               id="exampleFormControlFile1"
                                               onchange="previewImage(event)" 
                                               accept=".jpg,.jpeg" />

                                        <span asp-validation-for="File" class="text-danger"></span>
                                    </div>
                                    <!-- Display Existing Image (if available) -->
                                    @if (Model != null && !string.IsNullOrEmpty(Model.Person_Image))
                                    {
                                        <div class="form-group">
                                            <label>Current Image</label>
                                            <div>
                                                <img src="@Url.Content("~/"+ Model.Person_Image)" alt="Person Image" style="max-width: 150px; max-height: 150px;" />
                                            </div>
                                        </div>
                                    }

                                    <!-- Display Image Preview when uploading a new image -->
                                    <div class="form-group" id="imagePreview" style="display:none;">
                                        <label>Selected Image</label>
                                        <div>
                                            <img id="previewImg" src="#" alt="Image Preview" style="max-width: 150px; max-height: 150px;" />
                                        </div>
                                    </div>

                                    <!-- Error message for invalid image size or type -->
                                    <div class="form-group">
                                        <span id="imageSizeError" class="text-danger" style="display:none;">The image size should not exceed 200KB.</span>
                                        <span id="imageTypeError" class="text-danger" style="display:none;">Only JPG or JPEG images are allowed.</span>
                                    </div>
                                    <div class="form-group form-inline">
                                        <label for="inlineinput"
                                               class="col-md-3 col-form-label">Upload AadharCard*</label>
                                        <div class="col-md-9 p-0">
                                            <input type="text"
                                                   asp-for="Person_AadharCard"
                                                   class="form-control input-full"
                                                   id="inlineinput"
                                                   placeholder="" />
                                            <span asp-validation-for="Person_AadharCard" class="text-danger"></span>
                                        </div>
                                    </div>

                                    <div class="form-group form-inline">
                                        <label for="inlineinput"
                                               class="col-md-3 col-form-label">Set Password*</label>
                                        <div class="col-md-9 p-0">
                                            <input type="text"
                                                   asp-for="Person_PassWord"
                                                   class="form-control input-full"
                                                   id="inlineinput"
                                                   placeholder="" />
                                            <span asp-validation-for="Person_PassWord" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-action">
                            <button type="submit" class="btn btn-success">Submit</button>
                            <button type="reset" class="btn btn-danger">Cancel</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    function previewImage(event) {
        var input = event.target;
        var imageSizeError = document.getElementById('imageSizeError');
        var imageTypeError = document.getElementById('imageTypeError');
        var imagePreview = document.getElementById('imagePreview');
        var preview = document.getElementById('previewImg');

        // Check if a file is selected
        if (input.files && input.files[0]) {
            var file = input.files[0];
            var fileType = file.type;

            // Validate file type (jpg, jpeg)
            var validImageTypes = ['image/jpeg', 'image/jpg'];
            if (!validImageTypes.includes(fileType)) {
                imageTypeError.style.display = 'block'; // Show type error message
                imageSizeError.style.display = 'none';  // Hide size error message
                imagePreview.style.display = 'none';    // Hide preview
                preview.src = ''; // Clear preview image src

                // Clear the file input if file type is invalid
                input.value = '';  // This will reset the file input

                return; // Exit if file type is invalid
            }

            // Clear file type error if valid
            imageTypeError.style.display = 'none';

            // Validate file size (200KB = 200 * 1024 bytes)
            if (file.size > 200 * 1024) {
                imageSizeError.style.display = 'block'; // Show size error message
                imagePreview.style.display = 'none';    // Hide preview
                preview.src = ''; // Clear preview image src

                // Clear the file input if file size exceeds the limit
                input.value = '';  // This will reset the file input

                return; // Exit if file is too large
            }

            // Clear error messages if valid
            imageSizeError.style.display = 'none';

            var reader = new FileReader();
            reader.onload = function () {
                preview.src = reader.result; // Set preview image src
                imagePreview.style.display = 'block'; // Show the preview section
            }
            reader.readAsDataURL(file); // Read the selected image file
        }
    }
</script>
<script>
    function OnHostelChange() {
        var Hostel_Id = $("#Hostel_ID").val();
        // var UserID = $("#Room_Id").val();

        if (Hostel_Id !== "") {
            $("#Room_ID").empty();
            $("#Room_ID").append($("<option></option>").val("").html("Select Room"));
            $.ajax(
                {
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "@Url.Action("PG_Room_RoomDropDownByHostelId", "PG_Person", new { area = "PG_Person" })" + "?&Hostel_Id=" + Hostel_Id,
                    data: {},
                    dataType: "json",
                    success: function (Result) {
                        $.each(Result, function (index, item) {
                            $("#Room_ID").append($("<option></option>").val(item.id).html(item.room_SharingType));
                            // alert(JSON.stringify(item));
                        });
                    },

                    error: function (err) {
                        console.error("Error While Running AJAX in hostel :", err); // Log the error details
                        alert("Error While Running AJAX");
                    }
                }
            )
        }
        else {
            $("#Room_ID").empty();
            $("#Room_ID").append($("<option></option>").val("").html("Select Room"));
        }
    }

    function OnRoomChange() {
        var Room_ID = $("#Room_ID").val();
        // var UserID = $("#Room_Id").val();
        if (Room_ID !== "") {
            $("#Bed_ID").empty();
            $("#Bed_ID").append($("<option></option>").val("").html("Select bed"));
            $.ajax(
                {
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "@Url.Action("PG_Bed_BedDropDownByRoomId", "PG_Person", new { area = "PG_Person" })" + "?&Room_ID=" + Room_ID,
                    data: {},
                    dataType: "json",
                    success: function (Result) {
                        $.each(Result, function (index, item) {
                            // alert(JSON.stringify(Result));
                            // console.log(Result); // Inspect the data
                            $("#Bed_ID").append($("<option></option>").val(item.id).html(item.bed_Number));
                        });
                    },

                    error: function (err) {
                        console.error("Error While Running AJAX in room:", err); // Log the error details
                        alert("Error While Running AJAX");
                    }
                }
            )
        }
        else {
            $("#Bed_ID").empty();
            $("#Bed_ID").append($("<option></option>").val("").html("Select Room"));
        }
    }
</script>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}



@*
                                    <div class="form-group form-inline">
                                    <label for="inlineinput"
                                    class="col-md-3 col-form-label">Select PG</label>
                                    <div class="col-md-9 p-0">
                                    <select class="form-control input-full" data-control="select2" data-placeholder="Select PG Hostel" asp-for="Hostel_ID" asp-items="@(new SelectList(ViewBag.HostelList, "Id", "PG_Number"))" onchange="OnHostelChange();">
                                    <option value="">Select Hostel</option>
                                    </select>
                                    <span asp-validation-for="Hostel_ID" class="text-danger"></span>
                                    </div>
                                    </div>

                                    <div class="form-group form-inline">
                                    <label for="inlineinput"
                                    class="col-md-3 col-form-label">Select Room Sharing</label>
                                    <div class="col-md-9 p-0">
                                    <select class="form-control input-full" data-control="select2" data-placeholder="Select Room" asp-for="Room_ID" asp-items="@(new SelectList(ViewBag.RoomList,"Id","Room_SharingType"))" onchange="OnRoomChange();">
                                    <option value="">Select Room Sharing</option>
                                    </select>
                                    <span asp-validation-for="Room_ID" class="text-danger"></span>
                                    </div>
                                    </div>

                                    <div class="form-group form-inline">
                                    <label for="inlineinput"
                                    class="col-md-3 col-form-label">Select Bed</label>
                                    <div class="col-md-9 p-0">
                                    <select class="form-control input-full" data-control="select2" data-placeholder="Select Room" asp-for="Bed_ID" asp-items="@(new SelectList(ViewBag.BedList, "Id", "Bed_Number", Model?.Bed_ID))">
                                    <option value="">Select Bed</option>
                                    </select>
                                    <span asp-validation-for="Bed_ID" class="text-danger"></span>
                                    </div>
                                    </div> *@